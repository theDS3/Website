---
import '../styles/layout/Header.scss';

import DS3_Logo from '/DS3_Logo.webp';

interface Link {
  title: string;
  href: string;
  sublinks?: Link[];
}

const links: Link[] = [
  { title: 'About Us', href: '/#about-us' },
  { title: 'Sponsors', href: '/#sponsors' },
  { title: 'Team', href: '/#team' },
  { title: 'Events', href: '/#events' },
  { title: 'Resources', href: '/#resources' },
];
---

<header>
  <a href="/">
    <img
      src={DS3_Logo}
      alt="DS3 Logo"
    />
  </a>
  <nav>
    <ul class="menu">
      {
        links.map((link) => {
          if (link.sublinks === undefined)
            return (
              <li class="item">
                <a href={link.href}>{link.title}</a>
              </li>
            );
          return (
            <li class="item has-submenu">
              <p>
                {link.title}
                <iconify-icon icon="fa:angle-down" />
              </p>
              <ul class="submenu">
                {link.sublinks?.map((sublink) => {
                  return (
                    <li class="subitem">
                      <a href={sublink.href}>{sublink.title}</a>
                    </li>
                  );
                })}
              </ul>
            </li>
          );
        })
      }
    </ul>
  </nav>
  <button class="toggle">
    <iconify-icon icon="fa:bars"></iconify-icon>
  </button>
</header>

<script is:inline>
  const nav = document.querySelector('nav');
  const menu = document.querySelector('.menu');
  const items = document.querySelectorAll('.item');
  const toggle = document.querySelector('.toggle');

  /* Event Listeners */

  // To open/close the navbar
  toggle.addEventListener('click', toggleMenu);

  // To open/close the submenu
  for (const item of items) {
    if (item.querySelector('.submenu')) {
      item.addEventListener('click', toggleSubmenu);
    }
    item.addEventListener('keypress', toggleSubmenu);
  }

  // To close submenu when clicking outside
  document.addEventListener('click', closeSubmenu, false);

  /* Toggle Mobile Menuu */
  function toggleMenu() {
    if (menu.classList.contains('active')) {
      menu.classList.remove('active');
      nav.classList.remove('show');
      toggle.querySelector('iconify-icon').icon = 'fa:bars';
    } else {
      menu.classList.add('active');
      nav.classList.add('show');
      toggle.querySelector('iconify-icon').icon = 'fa:times';
    }
  }

  /* Toggle Subemenu */
  function toggleSubmenu() {
    const tag = menu.querySelector('.submenu-active');
    if (this.classList.contains('submenu-active')) {
      this.classList.remove('submenu-active');
      this.querySelector('iconify-icon').icon = 'fa:angle-down';
    } else if (tag) {
      tag.querySelector('iconify-icon').icon = 'fa:angle-down';
      tag.classList.remove('submenu-active');
      this.classList.add('submenu-active');
      this.querySelector('iconify-icon').icon = 'fa:angle-up';
    } else {
      this.classList.add('submenu-active');
      this.querySelector('iconify-icon').icon = 'fa:angle-up';
    }
  }

  /* Close Submenu From Anywhere */
  function closeSubmenu(e) {
    const tag = menu.querySelector('.submenu-active');
    if (tag) {
      let isClickInside = menu
        .querySelector('.submenu-active')
        .contains(e.target);

      if (!isClickInside && tag) {
        tag.querySelector('iconify-icon').icon = 'fa:angle-down';
        tag.classList.remove('submenu-active');
      }
    }
  }
</script>
